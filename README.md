# infodef <br/>
 server <br/>
Сервер храниться в папке Server, запуск осуществляется с использованием WebStorm консоли путёмм ввода команды npm run dev <br/>
Эта команда запускает другую команду nodemon index.js, где index.js - точка входа <br/>
Для корректной работы сервера требуется перечень зависимостей: <br/>
"dependencies": {
    "bcrypt": "^5.0.1",
    "cors": "^2.8.5",
    "dotenv": "^16.0.1",
    "express": "^4.18.1",
    "jsonwebtoken": "^8.5.1",
    "jwt-decode": "^3.1.2",
    "pg": "^8.7.3",
    "pg-hstore": "^2.3.4",
    "sequelize": "^6.19.2"
  },
В ппапку Server вложены несколько папок и файлов из которых <br/>
index.js - содержит код для запуска сервера, параметры сервера<br/>
.env - хранит глобальные переменные<br/>
package.json - информация о сборке<br/>
cert и key - сертификат и ключ, необходимые для работы https<br/>
bd.js - хранит глобальные переменные для базы данных<br/>
Далее идут папки:
- Controllers - обработчики запросов
- error - обработчики ошибок
- middleware - Связу́ющее програ́ммное обеспе́чение 
- models - модели, необходимые для работы ORM ( технология программирования, которая связывает базы данных с концепциями объектно-ориентированных языков программирования  )<br/>
В папке Controllers:messageConteroller и userController - обработчики
-userController - содержит функции registration и login
--registration:
1. из сообщения извлекаются {username,password}
2. происходит проверка на их неравенство null, если равен хоть один => ошибка 401 неверные данные при регистрации
3. проверка на наличие одноимённого пользователя(ORM) если существует => ошибка 401 неверные данные при регистрации
4. хэширование пороля
5. вставка в базу данных(НЕ ПО СРЕДСТВАМ ORM - обусловлено вставкой без id )
6. генерация токена и его возврат в результат с кодом 201<br/>
--login:
1. из сообщения извлекаются {username,password}
2. происходит проверка на их неравенство null, если равен хоть один => ошибка 400 неверные данные при входе
3. проверка на наличие одноимённого пользователя(ORM) если не существует => ошибка 400 неверные данные при входе
4. хэширование пороля и сравнение поролей если не эквивалентны => ошибка 400 неверные данные при входе
5. генерация токена и его возврат в результат с кодом 201<br/>
-messageController - содержит функции:getmy,getmecount,createmessage
--getmy:
1. извелечение токена из заголовка
2. проверка на существование токена и расшифрование
3. из расшифрованного токена получим пользователя, проверим на существование
4. используя ORM ищем в базе данных сообщения, адресованные пользователю, возвращаем массив объектов с атрибутами (attributes:['id','fromusername','title','message'])
5. передаём ответ в json-ответ с кодом 200
6. в случаях не описанных выше - ошибка 401 не авторизован<br/>
--getmecount
1. извелечение токена из заголовка
2. проверка на существование токена и расшифрование
3. из расшифрованного токена получим пользователя, проверим на существование
4. извлечём из тела сообщения даты, проверим на неравенство null, переведём в числовой формат
5.  используя ORM ищем в базе данных сообщения, адресованные пользователю, и ,при наличии даты сообщения, дата которых больше указанной
6. полученный ответ отправляем c кодом 200
7. в случаях, не описанных выше - ошибка 401 не аутентифицирован<br/>
В папке middleware: authMiddleware и ErrorHandler
-authMiddleware:
1. извелечение токена из заголовка
2. проверка на существование токена и расшифрование
3. в случае корректности токена - позволяет серверу продолжить обработку, иначе - res.status(401).send("Неверные данные для входа");<br/>
Помимо этого рекомендуется установить ngrok и запустить 
ввести команду ngrok http https://localhost:8080
Полученный адрес использовать для получения запросов в клиентском приложении
